<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>KSYLlive_iOS by ksvc</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">KSYLlive_iOS</h1>
      <h2 class="project-tagline">金山云iOS推流+播放融合sdk</h2>
      <a href="https://github.com/ksvc/KSYLive_iOS" class="btn">View on GitHub</a>
      <a href="https://github.com/ksvc/KSYLive_iOS/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/ksvc/KSYLive_iOS/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="ksy-live-ios-sdk使用手册" class="anchor" href="#ksy-live-ios-sdk%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C" aria-hidden="true"><span class="octicon octicon-link"></span></a>KSY Live iOS SDK使用手册</h1>

<h2>
<a id="阅读对象" class="anchor" href="#%E9%98%85%E8%AF%BB%E5%AF%B9%E8%B1%A1" aria-hidden="true"><span class="octicon octicon-link"></span></a>阅读对象</h2>

<p>本文档面向所有使用该SDK的开发人员, 测试人员等, 要求读者具有一定的iOS编程开发经验.</p>

<h2>
<a id="ksy-live-ios-sdk-概述" class="anchor" href="#ksy-live-ios-sdk-%E6%A6%82%E8%BF%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>KSY Live iOS SDK 概述</h2>

<p>KSY Live iOS SDK是金山云推出的 iOS 平台上使用的软件开发工具包(SDK), 其中Stremer负责采集和推流。MediaPlayer负责视频播放。</p>

<h2>
<a id="主要功能点" class="anchor" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E7%82%B9" aria-hidden="true"><span class="octicon octicon-link"></span></a>主要功能点</h2>

<h3>
<a id="stremer推流特点" class="anchor" href="#stremer%E6%8E%A8%E6%B5%81%E7%89%B9%E7%82%B9" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stremer推流特点</h3>

<ul>
<li>音频编码：AAC</li>
<li>视频编码：H.264 </li>
<li>推流协议：RTMP</li>
<li>视频分辨率：1280x720, 960x540,640x480,640x360,352x288</li>
<li>屏幕朝向： 横屏, 竖屏</li>
<li>iOS摄像头：前, 后置摄像头（可动态切换）</li>
<li>音视频目标码率：可设</li>
<li>根据网络带宽自适应调整视频的码率</li>
<li>闪光灯：开/关</li>
<li>Apple Doc 文档支持</li>
<li>可使用系统原生接口对当前采集设备进行操作</li>
</ul>

<h3>
<a id="mediaplayer播放特点" class="anchor" href="#mediaplayer%E6%92%AD%E6%94%BE%E7%89%B9%E7%82%B9" aria-hidden="true"><span class="octicon octicon-link"></span></a>MediaPlayer播放特点</h3>

<ul>
<li>与系统播放器MPMoviePlayerController接口一致，可以无缝快速切换至KSYMediaPlayer；</li>
<li>本地全媒体格式支持, 并对主流的媒体格式(mp4, avi, wmv, flv, mkv, mov, rmvb 等 )进行优化；</li>
<li>支持广泛的流式视频格式, HLS, RTMP, HTTP Rseudo-Streaming 等；</li>
<li>低延时直播体验，配合金山云推流sdk，可以达到全程直播稳定的4秒内延时；</li>
<li>实现快速满屏播放，为用户带来更快捷优质的播放体验；</li>
<li>版本适配支持iOS 7.0以上版本；</li>
<li>业内一流的H.265解码；</li>
<li>小于2M大小的超轻量级直播sdk；</li>
</ul>

<h2>
<a id="sdk-下载" class="anchor" href="#sdk-%E4%B8%8B%E8%BD%BD" aria-hidden="true"><span class="octicon octicon-link"></span></a>SDK 下载</h2>

<p>本SDK 提供如下三种获取方式:</p>

<ul>
<li>使用金山云账户邮件向 <a href="mailto:taochuntang@kingsoft.com">taochuntang@kingsoft.com</a>索取;</li>
<li>从github下载：<a href="https://github.com/ksvc/KSYLive_iOS.git">https://github.com/ksvc/KSYLive_iOS.git</a>
</li>
<li>使用Cocoapods进行安装，将如下语句加入你的Podfile：</li>
</ul>

<pre><code>pod 'KSYLive', :git =&gt; 'https://github.com/ksvc/KSYLive_iOS.git'
</code></pre>

<p>执行 pod install 或者  pod update后，将SDK加入工程。</p>

<h2>
<a id="sdk-内容说明" class="anchor" href="#sdk-%E5%86%85%E5%AE%B9%E8%AF%B4%E6%98%8E" aria-hidden="true"><span class="octicon octicon-link"></span></a>SDK 内容说明</h2>

<ol>
<li><p>SDK压缩包
如果获取到的为zip格式的压缩包，解压后的目录结构如下所示:</p></li>
</ol>

<ul>
<li>demo       : demo工程为KSYLive ，演示本SDK的主要接口的使用</li>
<li>doc/docset : appleDoc风格的接口文档，主要描述接口函数，参数和类型定义</li>
<li>doc/html   : html风格的<a href="http://ksvc.github.io/KSYLive_iOS/index.html">接口文档</a>
</li>
<li><p>framework  : 本SDK的静态库framework，集成时需要将该framework加入到项目中</p></li>
</ul>

<ol>
<li><p>SDK Cocoapods
通过Cocoapods 能将本SDK的静态库framework下载到本地</p></li>
<li><p>Streamer SDK与KSYMediaPlayer SDK打包融合未KSYLive SDK进行发布，避免使用 -all_load参数时的符号冲突问题。</p></li>
</ol>

<h1>
<a id="运行环境和兼容性" class="anchor" href="#%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%92%8C%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true"><span class="octicon octicon-link"></span></a>运行环境和兼容性</h1>

<ul>
<li>最低支持iOS版本：iOS 7.0</li>
<li>最低支持iPhone型号：iPhone 4</li>
<li>支持CPU架构： armv7, arm64</li>
<li>含有i386和x86_64模拟器版本的库文件，推流功能无法在模拟器上工作，播放功能完全支持模拟器。</li>
</ul>

<h1>
<a id="开始集成" class="anchor" href="#%E5%BC%80%E5%A7%8B%E9%9B%86%E6%88%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>开始集成</h1>

<ul>
<li>SDK压缩包
将压缩包中framework下的libksylive.framework添加到XCode的工程，具体步骤为：</li>
<li>选中应用的Target，进入项目配置页面</li>
<li>切换到 Build Phases标签页</li>
<li><p>在Link Binary With Libraries的列表中添加上 libksylive.framework<br>
(点击列表底部的加号，在弹出的向导中选择libksylive.framework)</p></li>
<li><p>SDK Cocoapods
在Podfile中本SDK的条目，并执行了 pod install 之后， 本SDK就已经加入工程中，打开工程的workspace即可</p></li>
</ul>

<h2>
<a id="streamer使用示例" class="anchor" href="#streamer%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>Streamer使用示例</h2>

<ul>
<li>在需要进行推流预览的VC类的实现文件中引入头文件</li>
</ul>

<pre><code>#import &lt;libksylive/libksylive.h&gt;
</code></pre>

<ul>
<li>SDK 鉴权设置
使用SDK前, 需要联系金山云获取合法的ak/sk 在开始推流前，需要使用KSYAuthInfo类的setAuthInfo将ak和加密后的sk传入SDK内部, 具体代码见demo中的initKSYAuth方法</li>
<li>SDK的核心类为<a href="http://ksvc.github.io/KSYLive_iOS/html/Classes/KSYStreamer.html">KSYStreamer</a>, 可以在VC中增加 KSYStreamer 的属性, 后续与推流相关的操作大部分都要通过KSYStreamer 来进行</li>
</ul>

<pre><code>@property KSYStreamer * streamer;
</code></pre>

<ul>
<li>创建KSYStreamer 的实例,并初始化, 注意本SDK不支持多实例, 同一时间只能有一个推流类的实例，否则会出现不可预期的问题</li>
</ul>

<pre><code>_streamer = [[KSYStreamer alloc] initWithDefaultCfg];
</code></pre>

<ul>
<li>设置采集和推流参数，主要是对分辨率，帧率等参数进行设置，具体可设置的内容参见KSYStreamer的属性。例如：</li>
</ul>

<pre><code>_streamer.videoDimension = KSYVideoDimension_16_9__640x360;

</code></pre>

<ul>
<li>设置消息通知的接收函数</li>
</ul>

<table>
<thead>
<tr>
<th>通知名称</th>
<th>通知说明</th>
<th>相关属性</th>
</tr>
</thead>
<tbody>
<tr>
<td>KSYCaptureStateDidChangeNotification</td>
<td>采集设备状态变化通知</td>
<td>captureState</td>
</tr>
<tr>
<td>KSYStreamStateDidChangeNotification</td>
<td>推流状态变化通知</td>
<td>streamState, streamErrorCode</td>
</tr>
<tr>
<td>KSYNetStateEventNotification</td>
<td>网络事件发生通知</td>
<td>netStateCode</td>
</tr>
</tbody>
</table>

<p>比如 当采集设备的状态发生变化时，对应的接收回调函数会被调用，通过_streamer.captureState属性,可查询到新的状态
其中如果推流状态变为 <a href="/html/Constants/KSYStreamState.html">KSYStreamStateError</a>,需要通过streamErrorCode 具体查询其错误原因</p>

<ul>
<li>开始/停止预览
通过如下接口启动和停止预览，当启动预览时，需要将显示预览的view传入到SDK中</li>
</ul>

<pre><code>[_streamer startPreview: self.view];
//....
[_streamer stopPreview];
</code></pre>

<p>在调用这一组接口后，对应操作开始和结束时会有KSYCaptureStateDidChangeNotification的状态通知
当采集设备的权限被用户禁用时，会进入KSYCaptureStateDevAuthDenied状态</p>

<ul>
<li>开始/停止推流, 开始推流时, 需要将推流的完整URL作为参数传入, 比如rtmp://xxx.xxx.xxx/appname/streamkey </li>
</ul>

<pre><code>[_streamer startStream:_hostURL];
//....
[_streamer stopStream];
</code></pre>

<p>在调用这一组接口后，对应操作开始和结束时会有 KSYStreamStateDidChangeNotification 的状态通知，
进入KSYStreamStateConnected 状态，表明推流成功；</p>

<h3>
<a id="其他操作" class="anchor" href="#%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>其他操作</h3>

<pre><code>[_streamer switchCamera]; // 在前后摄像头之间切换
[_streamer toggleTorch ]; // 开关闪关灯状态
</code></pre>

<h3>
<a id="状态监控" class="anchor" href="#%E7%8A%B6%E6%80%81%E7%9B%91%E6%8E%A7" aria-hidden="true"><span class="octicon octicon-link"></span></a>状态监控</h3>

<p>如果需要对推流状态进行监控，可以设置一个每秒刷新一次的timer，计算出网络发送速度（每秒发送的字节数）和视频编码速度（每秒编码的帧数）</p>

<h2>
<a id="mediaplayer-使用示例" class="anchor" href="#mediaplayer-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>MediaPlayer 使用示例</h2>

<p>请见github库：<a href="https://github.com/ksvc/KSYMediaPlayer_iOS.git">https://github.com/ksvc/KSYMediaPlayer_iOS.git</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/ksvc/KSYLive_iOS">KSYLlive_iOS</a> is maintained by <a href="https://github.com/ksvc">ksvc</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
